<template>
    <lightning-card title="Nearby Hotels" icon-name="standard:location">
        <template if:true={hotels}>
            <div class="slds-grid slds-wrap slds-p-around_medium">
                <template for:each={hotels} for:item="hotel">
                    <div key={hotel.hotelId} class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-p-around_small">
                        <lightning-card class="hotel-card">
                            <h3 class="slds-text-heading_small slds-p-horizontal_small">{hotel.name}</h3>
                            <div class="slds-p-horizontal_small slds-text-body_small">
                                <p><strong>Address:</strong> {hotel.address.lines}, {hotel.address.cityName}, {hotel.address.postalCode}</p>
                                <p><strong>Distance:</strong> {hotel.distance.value} {hotel.distance.unit}</p>
                                <p><strong>Chain Code:</strong> {hotel.chainCode}</p>
                                <p><strong>Last Updated:</strong> {hotel.lastUpdate}</p>
                                <div class="slds-m-top_small">
                                    <lightning-button 
                                        variant="brand" 
                                        label="Book Now" 
                                        title="Book Now"
                                        onclick={handleBookNow}
                                        data-hotelid={hotel.hotelId}
                                        class="book-now-button">
                                    </lightning-button>
                                </div>
                            </div>
                        </lightning-card>
                    </div>
                </template>
            </div>
        </template>

        <template if:true={error}>
            <div class="slds-p-around_medium slds-text-color_error">{error}</div>
        </template>

        <template if:true={loading}>
            <div class="slds-p-around_medium">
                <lightning-spinner alternative-text="Loading hotels..." size="medium"></lightning-spinner>
            </div>
        </template>
    </lightning-card>

    <template if:true={isOpen}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <button class="slds-button slds-modal__close" title="Close" onclick={closeModal}>
                        <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
                    </button>
                    <h2 class="slds-text-heading_medium">{heading}</h2>
                </header>

               <div class="slds-modal__content slds-p-around_medium">
                    <template if:true={showRoomInfo}>
                        <div class="slds-grid slds-wrap slds-gutters">
                            <template for:each={offers} for:item="offer">
                                <div key={offer.id} class="slds-col slds-size_1-of-1 slds-m-bottom_medium slds-box slds-box_x-small">
                                    <lightning-card>
                                        <!-- Make this grid a flex row -->
                                        <div class="slds-grid slds-gutters">
                                            
                                            <!-- LEFT SIDE CONTENT -->
                                            <div class="slds-col slds-size_2-of-3">
                                                <div class=" slds-m-around_x-small">
                                                    <h3 class="slds-text-heading_small slds-m-bottom_x-small">
                                                        <lightning-icon icon-name="utility:company" size="small" class="slds-m-right_x-small"></lightning-icon>
                                                        {offer.roomType}
                                                    </h3>
                                                    <p class="slds-text-title_caps slds-m-bottom_xx-small">{offer.category} â€¢ {offer.bedType}</p>
                                                    <p class="slds-m-bottom_xx-small">
                                                        <lightning-icon icon-name="utility:event" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                                        <strong>Check-In:</strong> {offer.checkIn}
                                                        &nbsp; | &nbsp;
                                                        <strong>Check-Out:</strong> {offer.checkOut}
                                                    </p>
                                                    <p class="slds-m-bottom_xx-small">
                                                        <lightning-icon icon-name="utility:money" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                                        <strong>Total Price:</strong> {offer.price} {offer.currency}
                                                    </p>
                                                    <p class="slds-m-bottom_xx-small">
                                                        <lightning-icon icon-name="utility:info" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                                        <strong>Rate Code:</strong> {offer.rateCode}
                                                    </p>
                                                    <p class="slds-m-bottom_xx-small">
                                                        <lightning-icon icon-name="utility:checkin" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                                        <strong>Cancellation:</strong> {offer.cancellationPolicy}
                                                    </p>
                                                    <p class="slds-m-bottom_xx-small">
                                                        <lightning-icon icon-name="utility:note" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                                        <strong>Room Description:</strong> {offer.description}
                                                    </p>
                                                </div>
                                            </div>

                                            <!-- RIGHT SIDE BUTTON (centered vertically) -->
                                            <div class="slds-col slds-size_1-of-3 
                                                        slds-grid 
                                                        slds-grid_vertical-align-center 
                                                        slds-grid_align-center">
                                                <lightning-button 
                                                    variant="brand" 
                                                    label="Book Now" 
                                                    data-name={offer.id}
                                                    onclick={handleBookHotel}>
                                                </lightning-button>
                                            </div>
                                        </div>
                                    </lightning-card>
                                </div>
                            </template>
                        </div>
                    </template>

                    <template if:true={showCreditCardInfo}>
                        <div class="slds-grid slds-wrap slds-gutters">

                            <!-- Card Number -->
                            <div class="slds-col slds-size_1-of-1 slds-m-bottom_small">
                                <lightning-input 
                                    label="Card Number" 
                                    type="text" 
                                    name="cardNumber"
                                    maxlength="19"
                                    placeholder="1234 5678 9012 3456"
                                    message-when-pattern-mismatch="Enter a valid card number"
                                    pattern="[0-9 ]{13,19}">
                                </lightning-input>
                            </div>

                            <!-- Card Holder Name -->
                            <div class="slds-col slds-size_1-of-1 slds-m-bottom_small">
                                <lightning-input 
                                    label="Card Holder Name" 
                                    type="text" 
                                    name="cardHolder"
                                    maxlength="50"
                                    placeholder="Name as on card"
                                    message-when-value-missing="Card holder name is required">
                                </lightning-input>
                            </div>

                            <!-- Expiry -->
                            <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                                <lightning-input 
                                    label="Expiry (MM/YY)" 
                                    type="text" 
                                    name="expiry"
                                    maxlength="5"
                                    placeholder="MM/YY"
                                    pattern="^(0[1-9]|1[0-2])\/\d{2}$"
                                    message-when-pattern-mismatch="Format: MM/YY">
                                </lightning-input>
                            </div>

                            <!-- CVV -->
                            <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                                <lightning-input 
                                    label="CVV" 
                                    type="password" 
                                    name="cvv"
                                    maxlength="4"
                                    placeholder="123"
                                    pattern="^[0-9]{3,4}$"
                                    message-when-pattern-mismatch="Enter a valid CVV">
                                </lightning-input>
                            </div>

                        </div>
                    </template>


                   
                </div>



                <footer class="slds-modal__footer">
                    <lightning-button variant="neutral" label="Close" onclick={closeModal}></lightning-button>
                    <template if:true={showCreditCardInfo}>
                        <lightning-button 
                            variant="brand" 
                            label="Book" 
                            class="slds-m-left_small"
                            onclick={handleBook}>
                        </lightning-button>
                    </template>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

    <template if:false={hasGivenFeedback}>
        <c-feedback></c-feedback>
    </template>

</template>
